<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    
    <script>
    // Se ejecuta antes de cargar el body para evitar el flash blanco
    const savedTheme = localStorage.getItem('f1-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
</script> <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClasificaciÃ³n de Pilotos Anual - F1</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-accordion {
            background-color: #333;
            color: white;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: 0.4s;
        }
        .active, .chart-accordion:hover { background-color: #e10600; }
        .chart-panel {
            padding: 20px;
            background-color: rgb(241, 241, 241);
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
        <h1>F1 RACING Stats</h1>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="clasificacion-pilotos-anual.html">ClasificaciÃ³n Anual</a></li>
                <li><a href="Head-to-Head.html">Head-to-Head</a></li>
                <li><a href="clasificacion-historica.html">Pilotos HistÃ³ricos</a></li>
                <li><a href="clasificacion-constructores.html">Constructores HistÃ³ricos</a></li>
                <li><a href="records-f1.html">RÃ©cords</a></li>
                <li><a href="circuitos.html">Circuitos</a></li>
            </ul>
        </nav>
    </header>
    <button class="theme-switch" onclick="toggleTheme()">ðŸŒ“ Cambiar Modo</button>

    <script>
        function toggleTheme() {
            const doc = document.documentElement;
            const currentTheme = doc.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Aplicar el tema
            doc.setAttribute('data-theme', newTheme);
            
            // Guardar la elecciÃ³n para todas las pÃ¡ginas
            localStorage.setItem('f1-theme', newTheme);
        }
    </script>

    <div class="container">
        <button class="chart-accordion" id="btn-grafico" onclick="toggleChart()">ðŸ“Š Ver EvoluciÃ³n de Puntos (Top 5) â†•</button>
        <div class="chart-panel" id="chart-container" style="display: none;">
            <canvas id="f1Chart" style="max-height: 400px;"></canvas>
        </div>

        <h2 id="current-year-title">ClasificaciÃ³n de Pilotos</h2>
        
        <div class="year-selector">
            <label for="year-select">Seleccionar AÃ±o:</label>
            <select id="year-select" onchange="loadClassification(this.value)"></select>
        </div>

        <table>
            <thead>
                <tr>
                    <th onclick="sortTable(0)" style="cursor:pointer">Pos â†•</th>
                    <th onclick="sortTable(1)" style="cursor:pointer">Piloto â†•</th>
                    <th onclick="sortTable(2)" style="cursor:pointer">Nacionalidad â†•</th>
                    <th onclick="sortTable(3)" style="cursor:pointer">EscuderÃ­a â†•</th>
                    <th onclick="sortTable(4)" style="cursor:pointer">Puntos â†•</th>
                </tr>
            </thead>
            <tbody id="classification-body"></tbody>
        </table>
    </div>

    <script src="data.js"></script>
    <script>
        function toggleChart() {
            const panel = document.getElementById("chart-container");
            const btn = document.getElementById("btn-grafico");
            panel.style.display = (panel.style.display === "none" || panel.style.display === "") ? "block" : "none";
            btn.classList.toggle("active");
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof f1_data === 'undefined') return;
            const years = Object.keys(f1_data).sort((a, b) => b - a);
            const selectElement = document.getElementById('year-select');
            years.forEach(year => {
                const option = new Option(year, year);
                selectElement.appendChild(option);
            });
            loadClassification(years[0]);
        });

        let myChart; 
        function loadClassification(year) {
            const data = f1_data[year];
            const tbody = document.getElementById('classification-body');
            document.getElementById('current-year-title').textContent = `ClasificaciÃ³n de Pilotos (${year})`;
            tbody.innerHTML = ''; 

            if (!data) return;

            // Rellenar tabla (esto ya lo tienes)
            data.forEach(piloto => {
                const row = tbody.insertRow();
                if (piloto.pos <= 3) row.className = 'p' + piloto.pos;
                row.insertCell().textContent = piloto.pos;
                row.insertCell().textContent = piloto.piloto;
                row.insertCell().textContent = piloto.nacionalidad;
                row.insertCell().textContent = piloto.escuderia;
                row.insertCell().textContent = piloto.puntos;
            });

            // --- LÃ“GICA DEL GRÃFICO ---
            const top5 = data.slice(0, 5);
            const ctx = document.getElementById('f1Chart').getContext('2d');
            if (myChart) myChart.destroy();

            const colores = ['#ffd700', '#c0c0c0', '#cd7f32', '#e10600', '#333333'];

            // AQUÃ VAN LAS LÃNEAS QUE PREGUNTABAS:
            const tieneEvolucion = top5[0] && top5[0].evolucion;
            const totalCarreras = tieneEvolucion ? top5[0].evolucion.length : 1;
            const labels = tieneEvolucion 
                ? Array.from({length: totalCarreras}, (_, i) => `GP ${i + 1}`)
                : ['Final'];

            myChart = new Chart(ctx, {
                type: 'line', 
                data: {
                    labels: labels, 
                    datasets: top5.map((p, index) => ({
                        label: p.piloto,
                        data: p.evolucion || [p.puntos], 
                        borderColor: colores[index],
                        backgroundColor: colores[index],
                        tension: 0.3,
                        fill: false
                    }))
                },
                options: {
    responsive: true,
    maintainAspectRatio: false // ESTO ES CLAVE para que use los 700px de altura del CSS
}
            });
        } // Fin de la funciÃ³n
     // <--- AQUÃ SE CIERRA loadClassification

        function sortTable(n) {
            const tbody = document.getElementById("classification-body");
            const rows = Array.from(tbody.rows);
            let ascending = this.asc = !this.asc;

            rows.sort((a, b) => {
                let x = a.cells[n].textContent;
                let y = b.cells[n].textContent;
                return isNaN(x) ? x.localeCompare(y) * (ascending ? 1 : -1) : (x - y) * (ascending ? 1 : -1);
            });
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>