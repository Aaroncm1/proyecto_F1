<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClasificaciÃ³n de Pilotos Anual - F1</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-accordion {
            background-color: #333;
            color: white;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: 0.4s;
        }

        .active, .chart-accordion:hover {
            background-color: var(--color-acento);
        }

        .chart-panel {
            padding: 20px;
            background-color: white;
            overflow: hidden;
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
            margin-bottom: 20px;
            /* No ponemos el display aquÃ­ para evitar conflictos */
        }
    </style>
</head>
<body>
    <header>
        <h1>F1 RACING Stats</h1>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="clasificacion-pilotos-anual.html">ClasificaciÃ³n Anual</a></li>
                <li><a href="Head-to-Head.html">Head-to-Head</a></li>
                <li><a href="clasificacion-historica.html">Pilotos HistÃ³ricos</a></li>
                <li><a href="clasificacion-constructores.html">Constructores HistÃ³ricos</a></li>
                <li><a href="records-f1.html">RÃ©cords</a></li>
                <li><a href="circuitos.html">Circuitos</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <button class="chart-accordion" id="btn-grafico" onclick="toggleChart()">ðŸ“Š Ver EvoluciÃ³n de Puntos (Top 5) â†•</button>
        <div class="chart-panel" id="chart-container" style="display: none;">
            <canvas id="f1Chart" style="max-height: 400px;"></canvas>
        </div>

        <h2 id="current-year-title">ClasificaciÃ³n de Pilotos</h2>
        
        <div class="year-selector">
            <label for="year-select">Seleccionar AÃ±o:</label>
            <select id="year-select" onchange="loadClassification(this.value)"></select>
        </div>

        <table>
            <thead>
                <tr>
                    <th onclick="sortTable(0)" style="cursor:pointer">Pos â†•</th>
                    <th onclick="sortTable(1)" style="cursor:pointer">Piloto â†•</th>
                    <th onclick="sortTable(2)" style="cursor:pointer">Nacionalidad â†•</th>
                    <th onclick="sortTable(3)" style="cursor:pointer">EscuderÃ­a â†•</th>
                    <th onclick="sortTable(4)" style="cursor:pointer">Puntos â†•</th>
                </tr>
            </thead>
            <tbody id="classification-body"></tbody>
        </table>
    </div>

    <script src="data.js"></script>
    <script>
        // FunciÃ³n corregida para el extensible
        function toggleChart() {
            const panel = document.getElementById("chart-container");
            const btn = document.getElementById("btn-grafico");
            
            if (panel.style.display === "none" || panel.style.display === "") {
                panel.style.display = "block";
                btn.classList.add("active");
            } else {
                panel.style.display = "none";
                btn.classList.remove("active");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const years = Object.keys(f1_data).sort((a, b) => b - a);
            const selectElement = document.getElementById('year-select');

            years.forEach(year => {
                const option = new Option(year, year);
                selectElement.appendChild(option);
            });

            loadClassification(years[0]);
        });

        let myChart; 

        function loadClassification(year) {
            const data = f1_data[year];
            const tbody = document.getElementById('classification-body');
            document.getElementById('current-year-title').textContent = `ClasificaciÃ³n de Pilotos (${year})`;
            tbody.innerHTML = ''; 

            if (!data) return;

            data.forEach(piloto => {
                const row = tbody.insertRow();
                if (piloto.pos <= 3) row.className = 'p' + piloto.pos;

                row.insertCell().textContent = piloto.pos;
                row.insertCell().textContent = piloto.piloto;
                row.insertCell().textContent = piloto.nacionalidad;
                row.insertCell().textContent = piloto.escuderia;
                row.insertCell().textContent = piloto.puntos;
            });

            // LÃ³gica del grÃ¡fico
            const top5 = data.slice(0, 5);
            const ctx = document.getElementById('f1Chart').getContext('2d');
            if (myChart) myChart.destroy();

            const colores = ['#ffd700', '#c0c0c0', '#cd7f32', '#e10600', '#333333'];

            myChart = new Chart(ctx, {
                type: 'line', 
                data: {
                    labels: ['Carrera 1', 'Mitad de Temporada', 'Gran Final'], 
                    datasets: top5.map((p, index) => ({
                        label: p.piloto,
                        data: [0, Math.round(p.puntos * 0.55), p.puntos], 
                        borderColor: colores[index],
                        backgroundColor: colores[index],
                        tension: 0.3,
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        let currentSortCol = -1;
        let sortAscending = true;

        function sortTable(n) {
            const tbody = document.getElementById("classification-body");
            const rows = Array.from(tbody.rows);
            
            // Si hacemos clic en la misma columna, invertimos el orden
            if (currentSortCol === n) {
                sortAscending = !sortAscending;
            } else {
                sortAscending = true; // Si es una columna nueva, empezamos ascendente
            }
            currentSortCol = n;

            rows.sort((a, b) => {
                let x = a.cells[n].textContent;
                let y = b.cells[n].textContent;

                // Intentar comparar como nÃºmeros si es posible (para PosiciÃ³n y Puntos)
                const numX = parseFloat(x);
                const numY = parseFloat(y);

                if (!isNaN(numX) && !isNaN(numY)) {
                    return sortAscending ? numX - numY : numY - numX;
                }

                // Comparar como texto (para Piloto, Nacionalidad, etc.)
                return sortAscending 
                    ? x.localeCompare(y, undefined, { sensitivity: 'base' })
                    : y.localeCompare(x, undefined, { sensitivity: 'base' });
            });

            // Limpiar y volver a aÃ±adir las filas ordenadas
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>